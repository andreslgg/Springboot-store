<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Location Form</title>
    <link rel="stylesheet"  th:href="@{/location.css}">
</head>
<body>
<div class="container-form">
    <div class="form-section">

        <form  action="#" method="post">
            <div class="address-container">
            <button class="back-button" onclick="window.history.back()"><i><?xml version="1.0" encoding="UTF-8" standalone="no"?> <!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools --> <svg width="20px" height="20px" viewBox="-4.5 0 20 20" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"> <title>arrow_left [#335]</title> <desc>Created with Sketch.</desc> <defs> </defs> <g id="Page-1" background="#fff" stroke="none" stroke-width="1" fill="#232323" fill-rule="evenodd"> <g id="Dribbble-Light-Preview" transform="translate(-345.000000, -6679.000000)" fill="#000000"> <g id="icons" transform="translate(56.000000, 160.000000)"> <path d="M299.633777,6519.29231 L299.633777,6519.29231 C299.228878,6518.90256 298.573377,6518.90256 298.169513,6519.29231 L289.606572,6527.55587 C288.797809,6528.33636 288.797809,6529.60253 289.606572,6530.38301 L298.231646,6538.70754 C298.632403,6539.09329 299.27962,6539.09828 299.685554,6538.71753 L299.685554,6538.71753 C300.100809,6538.32879 300.104951,6537.68821 299.696945,6537.29347 L291.802968,6529.67648 C291.398069,6529.28574 291.398069,6528.65315 291.802968,6528.26241 L299.633777,6520.70538 C300.038676,6520.31563 300.038676,6519.68305 299.633777,6519.29231" id="arrow_left-[#335]"> </path> </g> </g> </g> </svg></i></button>
        <h2>Location Form</h2>
            </div>
            <label for="postalcode"><strong>Postal Code *</strong></label>
            <input type="number" id="postalcode" name="postalcode" placeholder="Enter postal code" onkeyup="fetchSuggestions()" autocomplete="off" required>
            <ul id="suggestions"></ul>

            <label for="country"><strong>Country *</strong></label>
            <input type="text" id="country" name="country" readonly required>

            <label for="state"><strong>State *</strong></label>
            <input type="text" id="state" name="state" readonly required>

            <label for="city"><strong>City *</strong></label>
            <input type="text" id="city" name="city" readonly required>

            <label for="street"><strong>Street *</strong></label>
            <input type="text" id="street" name="street" placeholder="Enter street name" required>

            <div class="address-container">
                <div>
                    <label for="externalNumber"><strong>External Number *</strong></label>
                    <input type="number" id="externalNumber" name="externalNumber" placeholder="External number" required>
                </div>
                <div>
                    <label for="internalNumber"><strong>Internal Number</strong></label>
                    <input type="text" id="internalNumber" name="internalNumber" placeholder="Internal number (optional)">
                </div>
            </div>

            <button type="submit">Save Location</button>
        </form>
    </div>

    <!-- Instruction Text -->
    <div class="instructions">
        <h1>Complete Your Location</h1>
        <p>Enter your postal code and select an option from the suggestions. The city, state, and country fields will be filled automatically. Then, complete the street and house number fields to finalize your address.</p>
    </div>
</div>

<script>
    function fetchSuggestions() {
        const postalCode = document.getElementById('postalcode').value;
        if (postalCode.length < 3) return;

        fetch(`/autocomplete?query=${postalCode}`)
            .then(response => response.json())
            .then(data => {
                const suggestions = document.getElementById('suggestions');
                suggestions.innerHTML = "";

                data.forEach(item => {
                    const li = document.createElement('li');
                    li.innerText = item.display_name;
                    li.onclick = () => fillLocationFields(item);
                    suggestions.appendChild(li);
                });
            })
            .catch(error => console.error('Error fetching suggestions:', error));
    }

    function fillLocationFields(item) {
        document.getElementById('country').value = item.address.country || '';
        document.getElementById('state').value = item.address.state || '';
        document.getElementById('city').value = item.address.city || item.address.town || '';

        document.getElementById('street').value = "";
        document.getElementById('externalNumber').value = "";
        document.getElementById('internalNumber').value = "";

        document.getElementById('suggestions').innerHTML = "";
        document.getElementById('postalcode').value = item.address.postcode || '';
    }
</script>

</body>
</html>
