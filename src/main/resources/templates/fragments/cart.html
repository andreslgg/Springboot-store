<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<div th:fragment="cartfragments" class="cart-container">
  <div class="col cart-items-section">
    <div class="cart-header">
      <div>
        <p class="cart-title"><i><?xml version="1.0" ?><svg height="24px" style="enable-background:new 0 0 1489.733 1698.268;" version="1.1" viewBox="0 0 1489.733 1698.268" width="24px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="shopping_bag_2"><path d="M1489.668,1540.226l-50.734-1145.759c-0.896-84.585-70.35-153.199-155.591-153.199h-257.892   C1004.523,106.268,886.593,0,744.689,0C602.747,0,484.784,106.268,463.85,241.268H206.313   c-85.217,0-154.649,68.616-155.543,153.202L0.064,1540.188C0.022,1541.16,0,1542.146,0,1543.121   c0,85.543,69.797,155.146,155.592,155.146h1178.556c85.79,0,155.586-69.583,155.586-155.127   C1489.733,1542.166,1489.712,1541.2,1489.668,1540.226z M744.689,132.141c68.746,0,126.941,46.126,145.617,109.126H598.998   C617.684,178.268,675.908,132.141,744.689,132.141z M1334.147,1566.268H155.592c-12.811,0-22.917-9.645-23.43-22.062   l50.674-1145.048c0.043-0.971,0.064-2.111,0.064-3.084c0-12.695,10.283-22.806,23.412-22.806H460v241.459   c0,36.49,29.51,66.07,66,66.07s66-29.58,66-66.07V373.268h304v241.459c0,36.49,29.51,66.07,66,66.07s66-29.58,66-66.07V373.268   h255.343c13.153,0,23.457,10.095,23.457,22.79c0,0.974,0.021,2.023,0.064,2.998l50.706,1145.117   C1357.057,1556.586,1346.953,1566.268,1334.147,1566.268z"/></g><g id="Layer_1"/></svg>
        </i> My cart</p>
        <p class="cart-items-count" th:text="${cartItems.items.size()}+ ' items in your cart'"></p>
      </div>
    </div>
    <hr>

    <!-- Lista de productos -->
    <div class="cart-items-list">
      <div class="cart-item" th:each="product : ${cartItems.items}">
        <div class="cart-item-body">
          <div class="cart-item-content">
            <div class="cart-item-details">
              <div>
                <img th:src="@{${product.product.image}}" class="product-image" alt="Shopping item">
              </div>
              <div class="product-info">
                <h5 class="product-title" th:text="${product.product.title}"></h5>

                <div th:if="${product.selectedColor!=null}" class="product-color">
                  <p class="color-label">Color: </p>
                  <div class="color-circle" th:style="'background-color: '+${product.selectedColor}"></div>
                </div>
              </div>
            </div>
            <div class="cart-item-quantity-price">
              <div class="quantity">
                <h5 class="quantity-value" th:text="${product.quantity}"></h5>
              </div>
              <div class="price">
                <h5 class="price-value" th:text="'$' + ${product.getTotalPrice()}"></h5>
              </div>
              <!-- Cada producto tendrÃ¡ su propio formulario para eliminarlo -->
              <form class="delete-item-form" th:action="@{/cart/remove}" method="post" onsubmit="return false">
                <input type="hidden"  name="productId" th:value="@{product.product.id}">
                <input type="hidden"  name="color" th:value="@{product.selectedColor}">
                <button
                        th:data-product-id="${product.product.id}"
                        th:data-selected-color="${product.selectedColor}"
                        onclick="removeFromCart(this)"
                        class="delete-button"><i class="fas fa-trash-alt"></i>
                </button>
              </form>


            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Resumen del carrito (summary) -->
    <hr>
  <div class="cart-summary">
    <h4>Order Summary</h4>
    <div class="summary-item">
      <span>Sub-Total:</span>
      <span class="bold" th:text="'$'+${cartItems.getTotalPrice()}"></span>
    </div>
    <div class="summary-item">
      <span>Shipping:</span>
      <span class="bold" th:text="${shippingCost}"></span>
    </div>
    <div class="summary-item">
      <span>Taxes:</span>
      <span class="bold">Calculated At Checkout</span>
    </div>

    <button type="button" class="checkout-btn" onclick="window.location.href='/checkout'"  th:disabled="${!hasProducts}"
            th:classappend="${!hasProducts ? 'disabled' : ''}">Checkout</button>
  </div>

</div>
</html>